HBase性能测试
============================

最近因为新的业务需求，测试HBase在新的硬件下的性能。将性能测试的心得总结如下。

HBase的存储体系
--------------------
HBase将HLog/HFile存储在HDFS上， HDFS将文件分成BLOCK，
每个BLOCK存储在DataNode本地的文件系统上。
所以整个HBase存储体系自下而上是: 存储介质 --> 本地文件系统 -> HDFS --> HBase.
只有子下而上分析清楚每个层面的性能和瓶颈，才能在最上层发挥出最好的性能。

在HBase读路径上有两层cache, 第一层是HBase层面上的Block Cache。如果Block
cache没有命中，数据请求会通过网络到达DataNode。

第二层是DataNode上操作系统的Cache。操作系统有预读等各种cache策略。
如果测试HBase的数据量 < 数据节点内存总量。一段时间之后数据都被cache在内存里面。
也印证测试结果，(RS与DataNode混部)在数据量和数据节点内存总量一定情况下，HBase读的性能差别不大。
(区别在于：HBase层面上的Block Cache越多，读的性能越稳定)
如果想测试数据完全从磁盘读上来的HBase读的性能，就需要关闭这两层Cache.

第一层可以通过设置HBase参数hfile.block.cache.size来关闭。
第二层需要关闭OS的Cache

使用工具
---------------------
好的工具可以很快帮忙发现问题和性能瓶颈。对现在服务器来说，性能瓶颈不外乎CPU/网络/磁盘IO。
fio/iostat/iftop/iotop/top

文件系统测试
---------------------
使用工具：fio
测试: 小块顺序写， 4k/16k/64k随机读, 顺序读的性能

SAS盘
~~~~~

SSD
~~~~~

HDFS性能测试
----------------------
HDFS主要存储HBase的WAL日志和HFile(SSTable)数据文件, 因此从HBase层主要关注HDFS顺序写性能和随机读性能。

从单机性能到整个集群性能

工具：TestDFSIO

顺序写(HLog)

随机读(读HFile)

网络带宽是否成为瓶颈


HBase性能测试
----------------------
从单机性能到整个集群性能
一个节点的性能
~~~~~~~~~~~~~~
写的性能
读的性能

整集群的性能
~~~~~~~~~~~~~~
是否有很好的水平扩展能力
